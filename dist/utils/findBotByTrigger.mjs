function c(r){return r.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}function h(r,i){let t=i.split(" ").reduce((s,u)=>{let[g,...d]=u.split(":"),l=d.join(":");return s[g]||(s[g]=[]),s[g].push(l),s},{}),a=c(r);return Object.entries(t).every(([s,u])=>u.some(g=>g.split(",").every(l=>{let n=c(l);switch(s.toLowerCase()){case"contains":return a.includes(n);case"notcontains":return!a.includes(n);case"startswith":return a.startsWith(n);case"endswith":return a.endsWith(n);case"exact":return a===n;default:return!1}})))}var V=async(r,i,t)=>{let a=await r.findFirst({where:{enabled:!0,triggerType:"all",instanceId:t}});if(a)return a;let s=await r.findMany({where:{enabled:!0,triggerType:"advanced",instanceId:t}});for(let e of s)if(h(i,e.triggerValue))return e;let u=await r.findFirst({where:{enabled:!0,triggerType:"keyword",triggerOperator:"equals",triggerValue:i,instanceId:t}});if(u)return u;let g=await r.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"regex",instanceId:t}}),d=null;for(let e of g)if(new RegExp(e.triggerValue).test(i)){d=e;break}if(d)return d;let l=await r.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"startsWith",instanceId:t}}),n=null;for(let e of l)if(i.startsWith(e.triggerValue)){n=e;break}if(n)return n;let w=await r.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"endsWith",instanceId:t}}),f=null;for(let e of w)if(i.endsWith(e.triggerValue)){f=e;break}if(f)return f;let p=await r.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"contains",instanceId:t}}),o=null;for(let e of p)if(i.includes(e.triggerValue)){o=e;break}return o||null};export{V as findBotByTrigger};
//# sourceMappingURL=findBotByTrigger.mjs.map