var c=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var b=(e,r)=>{for(var t in r)c(e,t,{get:r[t],enumerable:!0})},x=(e,r,t,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of W(r))!V.call(e,n)&&n!==t&&c(e,n,{get:()=>r[n],enumerable:!(a=T(r,n))||a.enumerable});return e};var k=e=>x(c({},"__esModule",{value:!0}),e);var m={};b(m,{findBotByTrigger:()=>v});module.exports=k(m);function h(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}function w(e,r){let t=r.split(" ").reduce((n,u)=>{let[g,...d]=u.split(":"),l=d.join(":");return n[g]||(n[g]=[]),n[g].push(l),n},{}),a=h(e);return Object.entries(t).every(([n,u])=>u.some(g=>g.split(",").every(l=>{let s=h(l);switch(n.toLowerCase()){case"contains":return a.includes(s);case"notcontains":return!a.includes(s);case"startswith":return a.startsWith(s);case"endswith":return a.endsWith(s);case"exact":return a===s;default:return!1}})))}var v=async(e,r,t)=>{let a=await e.findFirst({where:{enabled:!0,triggerType:"all",instanceId:t}});if(a)return a;let n=await e.findMany({where:{enabled:!0,triggerType:"advanced",instanceId:t}});for(let i of n)if(w(r,i.triggerValue))return i;let u=await e.findFirst({where:{enabled:!0,triggerType:"keyword",triggerOperator:"equals",triggerValue:r,instanceId:t}});if(u)return u;let g=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"regex",instanceId:t}}),d=null;for(let i of g)if(new RegExp(i.triggerValue).test(r)){d=i;break}if(d)return d;let l=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"startsWith",instanceId:t}}),s=null;for(let i of l)if(r.startsWith(i.triggerValue)){s=i;break}if(s)return s;let p=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"endsWith",instanceId:t}}),f=null;for(let i of p)if(r.endsWith(i.triggerValue)){f=i;break}if(f)return f;let y=await e.findMany({where:{enabled:!0,triggerType:"keyword",triggerOperator:"contains",instanceId:t}}),o=null;for(let i of y)if(r.includes(i.triggerValue)){o=i;break}return o||null};0&&(module.exports={findBotByTrigger});
//# sourceMappingURL=findBotByTrigger.js.map